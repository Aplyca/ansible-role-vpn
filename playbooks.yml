---
- name: Install and configure VPN
  hosts: all
  gather_facts: no
  roles:
    - { role: Aplyca.VPN, tags: ["vpn"] }
  tasks:
    - debug: var=vpn
      tags: vars
  post_tasks:
    - name: Test if IPSEC is installed
      shell: "ipsec --version"
      register: result
      failed_when: "'Linux Openswan' not in result.stdout"
    - name: Test if IPSEC is properly installed
      become: yes
      shell: "ipsec verify"
      register: result
      failed_when: "'FAILED' in result.stdout"
